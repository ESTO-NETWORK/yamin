<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>야민정음 beta v0.1</title>
</head>
<body>
<!-- ui는 수정 예정!!! -경록- -->
<label for="source_string">변환할 글자를 입력하세요!!</label>
{#    todo request delay 적용 필요#}
<br><textarea name="source_string" id="source_string" cols="30" rows="10" onkeyup="fetch_translate(this.value)"></textarea>
<br><label for="result_string">결과 : </label>
<br><textarea name="result_string" id="result_string" cols="30" rows="10"></textarea>
<br>
<button onclick="copy()">결과를 클립보드에 복사</button>

<script>

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function fetch_translate(obj) {
        fetch('get_split_korean', {
            method: 'post',
            mode: 'cors',
            cache: 'no-cache',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/json',
                "X-CSRFToken": getCookie('csrftoken')
            },
            body: JSON.stringify(obj)
        }).then(
            function (res) {
                res.json().then(
                    function (text) {
                        document.getElementById("result_string").value = text['translate_result'];
                    })
            })
    }

    // todo JS alert가 아닌 toast message로 전환하기
    function copy() {
        const text = document.getElementById("result_string");
        text.select();
        document.execCommand("copy");
        alert("클립보드에 복사 되었습니다.");
    }
</script>
</body>
</html>